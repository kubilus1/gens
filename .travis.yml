dist: bionic
language: c
#sudo: false
branches:
  only:
    - master
    - /^\d+\.\d+(\.\d+)?(-\S*)?$/
services:
  - docker


before_install:
  - docker pull ubuntu:bionic


#addons:
#  apt:
#    packages:
#    - texinfo
jobs:
  include:
  - stage: setup
    script:
    - pwd
    - ls
    - mkdir gen_src
    - mv . gen_src/.
  - stage: build
    script:
    - docker run -w /code/gens_src -it --rm -v `pwd`:/code ubuntu:bionic /bin/bash -c "cd gen_src && build.sh"
      #- export PKG_CONFIG_PATH=/usr/lib/i386-linux-gnu/pkgconfig/
      #- dpkg-buildpackage -v $TRAVIS_TAG
  - stage: release to github
    if: tag IS present
    deploy:
      provider: releases
      api_key: "$GITHUB_OAUTH_TOKEN"
      skip_cleanup: true
      file_glob: true
      file:
        - ./gens_*.deb
      on:
        tags: true
        repo: kubilus1/gens
